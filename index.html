<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Enigma HFT</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      margin: 0;
      padding: 20px;
      min-height: 100vh;
    }
    .container {
      max-width: 1100px;
      margin: 0 auto;
      background: rgb(255, 255, 255);
      border-radius: 20px;
      box-shadow: 0 20px 50px rgba(0,0,0,0.2);
      overflow: hidden;
    }
    header {
      background: #2c3e50;
      color: white;
      padding: 30px;
      text-align: center;
    }
    h1 { margin: 0; font-size: 2.5em; }
    .subtitle { opacity: 0.9; font-size: 1.1em;color: yellow; }
    main { padding: 30px; }
    .form-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 600;
      color: #2c3e50;
    }
    input, select {
      width: 100%;
      padding: 14px;
      border: 2px solid #ddd;
      border-radius: 10px;
      font-size: 16px;
      transition: all 0.3s;
    }
    input:focus, select:focus {
      outline: none;
      border-color: #667eea;
      box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
    }
    .readonly-field {
      background: linear-gradient(90deg, #f0f7ff, #f8fbff);
      font-weight: bold;
      color: #2c3e50;
      border: 2px solid #667eea;
    }
    .preview {
      background: linear-gradient(120deg, #a8edea 0%, #fed6e3 100%);
      padding: 25px;
      border-radius: 15px;
      text-align: center;
      font-size: 1.4em;
      margin: 25px 0;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .pnl-positive { color: #27ae60; font-weight: bold; }
    .pnl-negative { color: #e74c3c; font-weight: bold; }
    button {
      padding: 15px 30px;
      font-size: 1.1em;
      font-weight: bold;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-save {
      background: #27ae60;
      color: white;
    }
    .btn-clear {
      background: #e74c3c;
      color: white;
    }
    .btn-save:hover { background: #219a52; transform: translateY(-2px); }
    .btn-clear:hover { background: #c0392b; transform: translateY(-2px); }
    .charts-container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 30px;
      margin-top: 40px;
    }
    .chart-wrapper {
      background: white;
      padding: 20px;
      border-radius: 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.1);
    }
    .chart-title {
      text-align: center;
      font-size: 1.4em;
      margin-bottom: 15px;
      color: #504d2c;
    }
    @media (max-width: 900px) {
      .charts-container { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h3>Enigma ETF Hedge Fund</h3>
    <p class="subtitle">|| ‡§ó‡•ã‡§µ‡§ø‡§®‡•ç‡§¶‡§æ‡§Ø ‡§®‡§Æ‡•ã ‡§®‡§Æ‡§É ||</p>
  </header>

  <main>
    <div class="form-grid">
      <div>
        <label for="year">Year</label>
        <select id="year"></select>
      </div>
      <div>
        <label for="month">Month</label>
        <select id="month">
          <option value="1">January</option><option value="2">February</option>
          <option value="3">March</option><option value="4">April</option>
          <option value="5">May</option><option value="6">June</option>
          <option value="7">July</option><option value="8">August</option>
          <option value="9">September</option><option value="10">October</option>
          <option value="11">November</option><option value="12">December</option>
        </select>
      </div>
      <div>
        <label for="entry">Entry Price (‚Çπ)</label>
        <input type="number" step="0.01" id="entry" placeholder="e.g. 1250.75">
      </div>
      <div>
        <label for="exit">Exit Price (‚Çπ)</label>
        <input type="number" step="0.01" id="exit" placeholder="e.g. 1380.00">
      </div>
      <div>
        <label for="quantity">Quantity</label>
        <input type="number" min="1" id="quantity" placeholder="e.g. 500">
      </div>
      <div>
        <label for="charges">Charges (‚Çπ)</label>
        <input type="number" step="0.01" id="charges" value="0">
      </div>
      <div>
        <label>Capital Deployed (‚Çπ)</label>
        <input type="text" id="capital" class="readonly-field" readonly>
      </div>
      <div>
        <label>Realised Returns (‚Çπ)</label>
        <input type="text" id="pnl" class="readonly-field" readonly>
      </div>
    </div>

    <div style="text-align: center; margin: 30px 0;">
      <button class="btn-save" onclick="saveEntry()">üíæ Save Monthly Return</button>
      <!--<button class="btn-clear" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>-->
    </div>

    <div class="preview" id="preview">
      Enter your trade details above to see live calculation...
    </div>

    <div class="charts-container">
      <div class="chart-wrapper">
        <div class="chart-title">üìä Monthly Returns (%)</div>
        <canvas id="returnsChart"></canvas>
      </div>
      <div class="chart-wrapper">
        <div class="chart-title">üìà Capital Growth + 5-Year Projection</div>
        <canvas id="capitalChart"></canvas>
      </div>
    </div>
  </main>
</div>

<script>
  // Initialize date
  const now = new Date();
  const currentYear = now.getFullYear();
  const currentMonth = now.getMonth() + 1;

  // Populate years
  const yearSelect = document.getElementById('year');
  for (let y = currentYear - 10; y <= currentYear + 5; y++) {
    const opt = document.createElement('option');
    opt.value = y;
    opt.text = y;
    if (y === currentYear) opt.selected = true;
    yearSelect.appendChild(opt);
  }
  document.getElementById('month').value = currentMonth;

  // Elements
  const inputs = ['entry', 'exit', 'quantity', 'charges'];
  const capitalField = document.getElementById('capital');
  const pnlField = document.getElementById('pnl');
  const preview = document.getElementById('preview');

  let returnsChart, capitalChart;

  // Live calculation
  function calculate() {
    const e = parseFloat(document.getElementById('entry').value) || 0;
    const x = parseFloat(document.getElementById('exit').value) || 0;
    const q = parseFloat(document.getElementById('quantity').value) || 0;
    const c = parseFloat(document.getElementById('charges').value) || 0;

    const capital = e * q;
    const pnl = (x - e) * q - c;
    const returnPct = capital > 0 ? (pnl / capital) * 100 : 0;

    capitalField.value = capital.toFixed(2);
    pnlField.value = pnl.toFixed(2);

    if (e && x && q) {
      const color = pnl >= 0 ? '#27ae60' : '#e74c3c';
      preview.innerHTML = `
        <strong>${document.getElementById('month').options[document.getElementById('month').selectedIndex].text} 
        ${document.getElementById('year').value}</strong><br><br>
        Capital Deployed: <strong>‚Çπ${capital.toLocaleString('en-IN', {minimumFractionDigits: 2})}</strong><br>
        Realised PnL: <strong style="color:${color}">‚Çπ${pnl.toFixed(2)}</strong><br>
        Monthly Return: <strong style="color:${color}; font-size:1.2em">${returnPct.toFixed(2)}%</strong>
      `;
    } else {
      preview.innerHTML = 'Enter trade details to see live calculation...';
    }
  }

  // Attach listeners
  inputs.forEach(id => {
    document.getElementById(id).addEventListener('input', calculate);
  });
  document.getElementById('month').addEventListener('change', calculate);
  document.getElementById('year').addEventListener('change', calculate);

  // Save entry
  function saveEntry() {
    const year = parseInt(document.getElementById('year').value);
    const month = parseInt(document.getElementById('month').value);
    const entry = parseFloat(document.getElementById('entry').value);
    const exit = parseFloat(document.getElementById('exit').value);
    const quantity = parseFloat(document.getElementById('quantity').value);
    const charges = parseFloat(document.getElementById('charges').value) || 0;

    if (!entry || !exit || !quantity) {
      alert('Please fill Entry, Exit, and Quantity');
      return;
    }

    const capital = entry * quantity;
    const pnl = (exit - entry) * quantity - charges;
    const monthlyReturn = (pnl / capital) * 100;

    const data = JSON.parse(localStorage.getItem('tradeData') || '[]');
    const key = `${year}-${month}`;
    const existing = data.findIndex(d => d.key === key);

    const record = { year, month, entry, exit, quantity, charges, capital, pnl, monthlyReturn: parseFloat(monthlyReturn.toFixed(4)), key };

    if (existing >= 0) {
      if (!confirm('Entry for this month already exists. Overwrite?')) return;
      data[existing] = record;
    } else {
      data.push(record);
    }

    localStorage.setItem('tradeData', JSON.stringify(data));
    alert(`‚úÖ ${document.getElementById('month').options[month-1].text} ${year} saved successfully!`);
    renderCharts();
  }

  function clearAllData() {
    if (confirm('‚ö†Ô∏è Delete ALL your trading data permanently?')) {
      localStorage.removeItem('tradeData');
      renderCharts();
      preview.innerHTML = 'All data cleared!';
    }
  }

  // Render Charts
  function renderCharts() {
    const data = JSON.parse(localStorage.getItem('tradeData') || '[]');
    data.sort((a,b) => a.year - b.year || a.month - b.month);

    const labels = data.map(d => {
      const monthName = new Date(d.year, d.month-1).toLocaleString('default', { month: 'short' });
      return `${monthName} '${d.year.toString().slice(-2)}`;
    });

    const returns = data.map(d => d.monthlyReturn);

    // Monthly Returns Bar Chart
    const ctx1 = document.getElementById('returnsChart').getContext('2d');
    if (returnsChart) returnsChart.destroy();
    returnsChart = new Chart(ctx1, {
      type: 'bar',
      data: {
        labels: labels.length ? labels : ['No data'],
        datasets: [{
          label: 'Monthly Return %',
          data: returns.length ? returns : [0],
          backgroundColor: returns.map(r => r >= 0 ? 'rgba(39, 195, 113, 0.8)' : 'rgba(231, 76, 60, 0.8)'),
          borderRadius: 8,
        }]
      },
      options: {
        responsive: true,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true } }
      }
    });

    // Capital Growth + Projection
    const ctx2 = document.getElementById('capitalChart').getContext('2d');
    if (capitalChart) capitalChart.destroy();

    let capital = 1100000; // Starting capital
    const historical = [];
    const projLabels = [...labels];
    const projData = [];

    data.forEach(d => {
      capital *= (1 + d.monthlyReturn / 100);
      historical.push(capital);
    });

    projData.push(...historical);

    const avgReturn = data.length > 0 ? data.reduce((s,d) => s + d.monthlyReturn, 0) / data.length : 0;
    let futureCapital = capital;

    let projMonth = now.getMonth() + 1;
    let projYear = now.getFullYear();

    for (let i = 0; i < 60; i++) {
      projMonth++;
      if (projMonth > 12) { projMonth = 1; projYear++; }
      const monthName = new Date(projYear, projMonth-1).toLocaleString('default', { month: 'short' });
      projLabels.push(`${monthName} '${projYear.toString().slice(-2)}`);
      futureCapital *= (1 + avgReturn / 100);
      projData.push(futureCapital);
    }

    capitalChart = new Chart(ctx2, {
      type: 'line',
      data: {
        labels: projLabels,
        datasets: [{
          label: 'Capital Growth',
          data: projData,
          borderColor: '#667eea',
          backgroundColor: 'rgba(210, 238, 130, 0.5)',
          tension: 0.4,
          fill: true,
          pointBackgroundColor: ctx => ctx.dataIndex < historical.length ? '#667eea' : '#95a5a6'
        }]
      },
      options: {
        responsive: true,
        plugins: {
          title: { display: true, text: `Avg Monthly: ${avgReturn.toFixed(2)}% ‚Üí Annualized: ${((Math.pow(1 + avgReturn/100, 12) - 1)*100).toFixed(2)}%` }
        },
        scales: {
          y: {
            ticks: { callback: v => '‚Çπ' + (v/10000000).toFixed(2) + 'Cr' }
          }
        }
      }
    });
  }

  // Initial load
  calculate();
  renderCharts();
</script>

</body>
</html>
