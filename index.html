<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Journal</title>
    <!-- Add Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        /* Style the header */
        .header {
            background-color: #0a8b84;
            padding: 5px 10px;
            color: #fad326;
            text-align: center;
        }
        /* Progress Bar Styles */
        .progress-container {
            width: 100%;
            background-color: #09bcb3; /* Olive green for total */
            height: 20px;
            border-radius: 10px;
            border-color: #2e313f;
            overflow: hidden;
            margin-bottom: 20px;
            position: relative; /* For positioning percentage text */
        }
        .progress-bar {
            height: 100%;
            background-color: #4B0082; /* Deep purple default for allocated */
            width: 0%;
            transition: width 0.5s ease, background-color 0.5s ease;
            position: relative; /* For text positioning */
            display: flex;
            align-items: center;
            justify-content: center; /* Center the percentage text */
        }
        .progress-percentage {
            color: #fff;
            font-size: 12px;
            font-weight: bold;
            position: absolute; /* Ensure it stays on top */
            width: 100%;
            text-align: center;
        }
        input.cmn-toggle-round + label {
            padding: 2px;
            width: 100px;
            height: 30px;
            background-color: #9da9ad;
            border-radius: 30px;
        }
        input.cmn-toggle-round + label:before, input.cmn-toggle-round + label:after {
            display: block;
            position: absolute;
            top: 1px;
            left: 1px;
            bottom: 1px;
            content: "";
        }
        input.cmn-toggle-round + label:before {
            right: 1px;
            background-color: #888;
            border-radius: 30px;
            transition: background 0.4s;
        }
        input.cmn-toggle-round + label:after {
            width: 40px;
            background-color: #0a8b84;
            border-radius: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            transition: margin 0.4s;
        }
        input.cmn-toggle-round:checked + label:before {
            background-color: #bff49f;
        }
        input.cmn-toggle-round:checked + label:after {
            margin-left: 60px;
        }
        .cmn-toggle {
            position: absolute;
            margin-left: -9999px;
            visibility: hidden;
        }
        .cmn-toggle + label {
            display: block;
            position: relative;
            cursor: pointer;
            outline: none;
            user-select: none;
        }
        .left {
            width: 200px;
            float: left;
        }
        body {
            font-family: Arial, sans-serif;
            background: #0a8b84;
            color: #fff;
            max-width: 900px;
            margin: 20px auto;
            padding: 5px;
        }
        .checklist {
            background-color: rgb(108, 106, 106);
            padding: 5px;
            font-size: small;
            color: rgb(5, 5, 5);
            border-radius: 8px;
            margin-top: 10px;
        }
        .checklist-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1px 0;
        }
        .checklist-item .text {
            flex: 1;
            padding-left: 5px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        h1 {
            background-color: #0a8b84;
            text-align: center;
            color: #fad326;
            font-size: 2em;
            margin-bottom: 20px;
        }
        .form-container {
            background: #2e313f;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #fff;
            box-shadow: 0 2px 5px rgba(255, 255, 255, 0.1);
            margin-bottom: 20px;
        }
        label {
            display: block;
            margin: 10px 0 5px;
            font-weight: bold;
            color: #fff;
        }
        input, select, textarea {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            background: #333;
            color: #fff;
            border: 1px solid #666;
            border-radius: 4px;
        }
        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #fff;
            box-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
        }
        input[readonly] {
            background: #444;
            color: #ccc;
        }
        .points-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .points-container input {
            width: 100px;
        }
        button {
            background: #fff;
            color: #000;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #ccc;
        }
        .trade-list {
            margin-top: 20px;
        }
        .trade-table {
            width: 100%;
            border-collapse: collapse;
            background: #1a1a1a;
            border: 1px solid #666;
            border-radius: 5px;
            box-shadow: 0 1px 3px rgba(255, 255, 255, 0.1);
        }
        .trade-table th, .trade-table td {
            padding: 10px;
            border: 1px solid #666;
            text-align: left;
        }
        .trade-table th {
            background: #2e313f;
            color: #fff;
            font-weight: bold;
        }
        .trade-table td {
            color: #fff;
        }
        h2 {
            color: #fff;
        }
        .calendar-container {
            margin-top: 30px;
            padding: 20px;
            background: #2e313f;
            border-radius: 8px;
            border: 1px solid #fff;
        }
        .stats-container {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
        }
        .calendar-table {
            width: 100%;
            border-collapse: collapse;
        }
        .calendar-table th, .calendar-table td {
            padding: 10px;
            text-align: center;
            border: 1px solid #666;
        }
        .calendar-table th {
            background: rgb(248, 233, 121);
            color: #000;
        }
        .calendar-table td {
            background: #2e313f;
        }
        .calendar-table .weekly-total {
            background: #2e313f;
            font-weight: bold;
        }
        .calendar-table .monthly-total {
            background: #fff;
            color: #000;
            font-weight: bold;
        }
        .clear-button-container {
            text-align: center;
            margin-top: 20px;
        }
        .positive {
            color: #ebed5e; /* Green for profit */
        }
        .negative {
            color: #f9f3f4; /* Red for loss */
        }
        .monthlypositive {
            color: #32eb21; /* Green for profit */
        }
        .monthlynegative {
            color: #f56d84; /* Red for loss */
        }
        .chart-container {
            margin-top: 30px;
            padding: 20px;
            background: #2e313f;
            border-radius: 8px;
            border: 1px solid #fff;
        }
        canvas {
            max-width: 100%;
        }
        .projection-selector {
            margin: 10px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .footer {
            margin-top: 5px;
            color: #1f2020;
            font-size: 13px;
        }
    </style>
</head>
<body>
    

    <div id="myDIV" class="header">
        <h2 style="margin:5px;color:#fad326">olive green A+</h2>
    </div>
    <div class="progress-container">
      <div class="progress-bar" id="progressBar">
          <span class="progress-percentage" id="progressPercentage">0%</span>
      </div>
  </div>
    <div class="checklist">
        <div class="checklist-item">
            <div class="text">Overall trend - H1 L.H.S & H4 L Op [H1 G, M15 G-P->G]</div>
            <div class="toggle-container">
                <input id="cmn-toggle-1" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-1"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">S&R: OP Zone for impulse move [Draw M15,M30,H1 O- <b>Entry</b>]</div>
            <div class="toggle-container">
                <input id="cmn-toggle-2" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-2"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">OP confluence within tight range [M5/15 & M3]</div>
            <div class="toggle-container">
                <input id="cmn-toggle-4" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-4"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">OPx Trend: M1-Mpln, M5 OP(rej,white), M15 O, M30 R</div>
            <div class="toggle-container">
                <input id="cmn-toggle-7" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-7"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">HTF H1 Candle & Str aligns with LTF M5</div>
            <div class="toggle-container">
                <input id="cmn-toggle-3" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-3"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">Trending below HKGR* & LTF</div>
            <div class="toggle-container">
                <input id="cmn-toggle-5" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-5"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text">LTF HKGR cross / 5 signals <b>Re-Entry</b></div>
            <div class="toggle-container">
                <input id="cmn-toggle-6" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-6"></label>
            </div>
        </div>
        <div class="checklist-item">
            <div class="text"><b>Exit</b>: If P high is broken /Inverse O knock & Swg taken</div>
            <div class="toggle-container">
                <input id="cmn-toggle-8" class="cmn-toggle cmn-toggle-round" type="checkbox">
                <label for="cmn-toggle-8"></label>
            </div>
        </div>
    </div>

    <div class="footer">
        <span>Next 10 days: Fix your entry-Limit, Put generous SL, let it play [-31.5k]</span>
    </div>

    <div class="form-container">
        <form id="tradeForm">
            <label for="date">Date:</label>
            <input type="date" id="date" required>

            <label for="time">Time of Entry:</label>
            <input type="time" id="time" required>

            <label for="entryPrice">Entry Price:</label>
            <input type="number" id="entryPrice" step="0.01" required placeholder="e.g., 24030">

            <label for="stopLoss">Stop-Loss:</label>
            <input type="number" id="stopLoss" step="0.01" required placeholder="e.g., 23985">

            <label for="takeProfit">Take-Profit:</label>
            <input type="number" id="takeProfit" step="0.01" required placeholder="e.g., 24125">

            <label for="outcome">Outcome:</label>
            <select id="outcome" required>
                <option value="">Select Outcome</option>
                <option value="Win">Win</option>
                <option value="Loss">Loss</option>
                <option value="Breakeven">Breakeven</option>
            </select>

            <label for="outcomeAmount">Outcome Amount:</label>
            <input type="number" id="outcomeAmount" step="0.01" readonly placeholder="Calculated">

            <label for="pointsAllocated">Points Allocated:</label>
            <div class="points-container">
                <input type="number" id="pointsAllocated" step="1" min="0" required placeholder="e.g., 50">
                <span id="pointsRemaining">Remaining: 350/350</span>
            </div>

            <label for="emotion">Emotion:</label>
            <input type="text" id="emotion" required placeholder="e.g., Calm, Anxious">

            <label for="lesson">Lesson:</label>
            <textarea id="lesson" rows="3" required placeholder="e.g., Waited for confirmation, avoided false breakout"></textarea>

            <button type="submit">Add Trade</button>
        </form>
    </div>

    <div class="calendar-container">
        <h2>Calendar</h2>
        <div class="stats-container" id="statsContainer">
            <!-- Stats will be populated here -->
        </div>
        <table class="calendar-table" id="tradeCalendar">
            <!-- Calendar populated by JavaScript -->
        </table>
    </div>

    <div class="chart-container">
        <h2>Projected Returns</h2>
        <div class="projection-selector">
            <label for="projectionPeriod">Period:</label>
            <select id="projectionPeriod" onchange="updateChart()">
                <option value="12">12 Months</option>
                <option value="24">24 Months</option>
                <option value="36">36 Months</option>
            </select>
        </div>
        <canvas id="returnsChart"></canvas>
    </div>

    <div class="trade-list" id="tradeList">
        <h2>Trade Log</h2>
        <table class="trade-table" id="tradeTable">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Date</th>
                    <th>Time</th>
                    <th>Entry Price</th>
                    <th>Stop-Loss</th>
                    <th>Take-Profit</th>
                    <th>Outcome</th>
                    <th>Amount</th>
                    <th>Points Allocated</th>
                    <th>Emotion</th>
                    <th>Lesson</th>
                </tr>
            </thead>
            <tbody id="tradeTableBody">
                <!-- Trades will be populated here -->
            </tbody>
        </table>
    </div>
    <video width="100%" height="100%" controls>
      <source src="OliveGreen.mp4" type="video/mp4">
      Your browser does not support the video tag.
  </video>
    <div class="clear-button-container">
        <button type="button" onclick="clearTrades()">Clear All Trades</button>
    </div>

    <script>
        // Lot size from your trading plan
        const LOT_SIZE = 75;
        const TOTAL_POINTS = 350;

        // Load trades from localStorage or initialize empty array
        let trades = JSON.parse(localStorage.getItem('trades')) || [];

        // Chart variable
        let returnsChart;

        // Display trades and update UI on page load
        displayTrades();
        updateCalendar();
        updateChart();
        updatePointsProgress();

        // Clear trades function
        function clearTrades() {
            trades = [];
            localStorage.removeItem('trades');
            displayTrades();
            updateCalendar();
            updateChart();
            updatePointsProgress();
        }

        // Update points progress bar and remaining label
        function updatePointsProgress() {
            const totalAllocated = trades.reduce((sum, trade) => sum + trade.pointsAllocated, 0);
            const remainingPoints = TOTAL_POINTS - totalAllocated;
            const percentage = (totalAllocated / TOTAL_POINTS) * 100;

            const progressBar = document.getElementById('progressBar');
            const progressPercentage = document.getElementById('progressPercentage');
            progressBar.style.width = `${percentage}%`;
            progressPercentage.textContent = `${percentage.toFixed(0)}%`; // Display percentage with no decimals

            // Color logic for progress bar
            if (percentage >= 80) {
                progressBar.style.backgroundColor = '#E75480'; // Bright Pink
            } else if (percentage >= 50) {
                progressBar.style.backgroundColor = '#FFA500'; // Orange
            } else {
                progressBar.style.backgroundColor = '#C154C1'; // Deep purple
            }

            const pointsRemainingLabel = document.getElementById('pointsRemaining');
            pointsRemainingLabel.textContent = `Remaining: ${remainingPoints}/${TOTAL_POINTS}`;
        }

        // Handle form submission
        document.getElementById('tradeForm').addEventListener('submit', function(e) {
            e.preventDefault();

            const entryPrice = parseFloat(document.getElementById('entryPrice').value);
            const stopLoss = parseFloat(document.getElementById('stopLoss').value);
            const takeProfit = parseFloat(document.getElementById('takeProfit').value);
            const outcome = document.getElementById('outcome').value;

            let outcomeAmount;
            if (outcome === 'Win') {
                outcomeAmount = (takeProfit - entryPrice) * LOT_SIZE;
            } else if (outcome === 'Loss') {
                outcomeAmount = (stopLoss - entryPrice) * LOT_SIZE;
            } else {
                outcomeAmount = 0;
            }

            const trade = {
                date: document.getElementById('date').value,
                time: document.getElementById('time').value,
                entryPrice: entryPrice,
                stopLoss: stopLoss,
                takeProfit: takeProfit,
                outcome: outcome,
                outcomeAmount: outcomeAmount,
                pointsAllocated: parseInt(document.getElementById('pointsAllocated').value) || 0,
                emotion: document.getElementById('emotion').value,
                lesson: document.getElementById('lesson').value
            };

            trades.push(trade);
            localStorage.setItem('trades', JSON.stringify(trades));
            displayTrades();
            updateCalendar();
            updateChart();
            updatePointsProgress();
            this.reset();
        });

        // Update outcome amount preview
        document.getElementById('outcome').addEventListener('change', function() {
            const entryPrice = parseFloat(document.getElementById('entryPrice').value) || 0;
            const stopLoss = parseFloat(document.getElementById('stopLoss').value) || 0;
            const takeProfit = parseFloat(document.getElementById('takeProfit').value) || 0;
            const outcome = this.value;
            let outcomeAmount;

            if (outcome === 'Win') {
                outcomeAmount = (takeProfit - entryPrice) * LOT_SIZE;
            } else if (outcome === 'Loss') {
                outcomeAmount = (stopLoss - entryPrice) * LOT_SIZE;
            } else {
                outcomeAmount = 0;
            }

            document.getElementById('outcomeAmount').value = outcomeAmount.toFixed(2);
        });

        // Display trade entries in table format
        function displayTrades() {
            const tradeTableBody = document.getElementById('tradeTableBody');
            tradeTableBody.innerHTML = '';

            trades.forEach((trade, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${new Date(trade.date).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</td>
                    <td>${trade.time} IST</td>
                    <td>${trade.entryPrice.toFixed(2)}</td>
                    <td>${trade.stopLoss.toFixed(2)}</td>
                    <td>${trade.takeProfit.toFixed(2)}</td>
                    <td>${trade.outcome}</td>
                    <td class="${trade.outcomeAmount >= 0 ? 'positive' : 'negative'}">${trade.outcomeAmount.toFixed(2)}</td>
                    <td>${trade.pointsAllocated}</td>
                    <td>${trade.emotion}</td>
                    <td>${trade.lesson}</td>
                `;
                tradeTableBody.appendChild(row);
            });
        }

        // Function to calculate win rate
        function calculateWinRate() {
            if (trades.length === 0) return '0%';
            const wins = trades.filter(trade => trade.outcome === 'Win').length;
            return ((wins / trades.length) * 100).toFixed(2) + '%';
        }

        // Function to calculate average Risk-Reward ratio
        function calculateRiskReward() {
            if (trades.length === 0) return '0:0';
            
            let totalRisk = 0;
            let totalReward = 0;
            let validTrades = 0;

            trades.forEach(trade => {
                const risk = Math.abs(trade.entryPrice - trade.stopLoss);
                const reward = Math.abs(trade.takeProfit - trade.entryPrice);
                
                if (risk > 0) {  // Only count trades with valid risk
                    totalRisk += risk;
                    totalReward += reward;
                    validTrades++;
                }
            });

            if (validTrades === 0) return '0:0';
            
            const avgRisk = totalRisk / validTrades;
            const avgReward = totalReward / validTrades;
            const ratio = avgReward / avgRisk;
            return `1:${ratio.toFixed(2)}`;
        }

        // Update trade calendar with colored P&L and stats
        function updateCalendar() {
            const calendar = document.getElementById('tradeCalendar');
            const statsContainer = document.getElementById('statsContainer');
            calendar.innerHTML = '';

            const dailyPnL = {};
            trades.forEach(trade => {
                const date = trade.date;
                dailyPnL[date] = (dailyPnL[date] || 0) + trade.outcomeAmount;
            });

            const monthlyPnL = Object.values(dailyPnL).reduce((sum, pnl) => sum + pnl, 0);
            const winRate = calculateWinRate();
            const riskReward = calculateRiskReward();

            // Update stats container
            statsContainer.innerHTML = `
                <div>Monthly P&L: <span class="${monthlyPnL >= 0 ? 'monthlypositive' : 'monthlynegative'}">${monthlyPnL.toFixed(2)}</span></div>
                <div>Win Rate: ${winRate}</div>
                <div>Avg R:R: ${riskReward}</div>
            `;

            const today = new Date();
            const year = today.getFullYear();
            const month = today.getMonth();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const firstDay = new Date(year, month, 1).getDay();

            const table = document.createElement('table');
            table.classList.add('calendar-table');

            // Days of week
            const daysRow = document.createElement('tr');
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'P&L'];
            days.forEach(day => {
                const th = document.createElement('th');
                th.textContent = day;
                daysRow.appendChild(th);
            });
            table.appendChild(daysRow);

            // Calendar body
            let currentRow = document.createElement('tr');
            let weeklyPnL = 0;
            for (let i = 0; i < firstDay; i++) {
                currentRow.appendChild(document.createElement('td'));
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const dateStr = `${year}-${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
                const td = document.createElement('td');
                const pnl = dailyPnL[dateStr] || 0;
                td.innerHTML = `${day}<br><span class="${pnl > 0 ? 'positive' : 'negative'}">${pnl.toFixed(2)}</span>`;
                weeklyPnL += pnl;

                currentRow.appendChild(td);

                if ((firstDay + day) % 7 === 0 || day === daysInMonth) {
                    const weeklyTd = document.createElement('td');
                    weeklyTd.innerHTML = `<span class="${weeklyPnL > 0 ? 'positive' : 'negative'}">${weeklyPnL.toFixed(2)}</span>`;
                    weeklyTd.classList.add('weekly-total');
                    currentRow.appendChild(weeklyTd);
                    table.appendChild(currentRow);
                    currentRow = document.createElement('tr');
                    weeklyPnL = 0;
                }
            }

            calendar.appendChild(table);
        }

        // Function to calculate projected returns and update chart
        function updateChart() {
            const ctx = document.getElementById('returnsChart').getContext('2d');
            const winRate = parseFloat(calculateWinRate()) / 100 || 0;
            const riskRewardStr = calculateRiskReward().split(':')[1];
            const riskReward = parseFloat(riskRewardStr) || 0;
            const projectionPeriod = parseInt(document.getElementById('projectionPeriod').value) || 12;

            // Your current capital (1 lot size of Nifty 75)
            const initialCapital = 236000;
            // Assuming 20 trades per month as a base (adjustable)
            const tradesPerMonth = 20;
            let returns = [initialCapital];

            // Calculate expected return per trade
            const winReturn = riskReward; // Reward multiple
            const lossReturn = -1; // Risk is 1 unit
            const expectedReturnPerTrade = (winRate * winReturn) + ((1 - winRate) * lossReturn);

            // Project over selected period
            for (let month = 1; month <= projectionPeriod; month++) {
                const monthlyReturn = expectedReturnPerTrade * tradesPerMonth * (initialCapital * 0.01); // 1% risk per trade
                returns.push(returns[month - 1] + monthlyReturn);
            }

            // Month labels
            const months = ['Month 0'];
            const today = new Date();
            for (let i = 0; i < projectionPeriod; i++) {
                const date = new Date(today.getFullYear(), today.getMonth() + i, 1);
                months.push(date.toLocaleString('default', { month: 'short', year: 'numeric' }));
            }

            // Destroy previous chart if exists
            if (returnsChart) {
                returnsChart.destroy();
            }

            // Create new chart
            returnsChart = new Chart(ctx, {
                type: 'bar', //line
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Projected Capital',
                        data: returns,
                        borderColor: '#83e283',
                        backgroundColor: 'rgba(131, 226, 131, 0.2)',
                        fill: true,
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            title: {
                                display: true,
                                text: 'Capital (â‚¹)',
                                color: '#fff'
                            },
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: 'Months',
                                color: '#fff'
                            },
                            ticks: {
                                color: '#fff'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#fff'
                            }
                        }
                    }
                }
            });
        }
    </script>
</body>
</html>
